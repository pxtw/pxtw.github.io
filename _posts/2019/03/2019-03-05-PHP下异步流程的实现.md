---
layout: post
title: 'PHP下异步流程的实现'
date: 2019-03-05T20:54:25+11:00
location: 
---


<h2 class="entry-title" style="background-color: white; color: #222222; font-family: arial, helvetica, sans-serif; font-size: 1.6em; font-weight: 400; line-height: 27.2384px; margin: 0px 0px -0.3em; text-transform: uppercase;">
我正在写一个<strong style="font-family: georgia, times, serif; font-size: 12.8px;">基于PHP的多业务环境下的日志工具</strong><span style="font-family: georgia, times, serif; font-size: 12.8px;">，它的需要有的特性包括：</span></h2>
<div class="entry-content" style="background-color: white; color: #222222; font-family: georgia, times, serif; font-size: 12.8px;">
<blockquote style="background: rgb(235, 237, 239); color: #4d5663; padding: 0.1em 1em;">
<ol>
<li>多业务环境支持：Windows，Linux，Mac环境下的FCGI，FPM，CLI。</li>
<li>多输出目标支持：文件，数据库，控制台，邮件，SimpleLog Server。</li>
<li>可通过配置文件配置模块功能。</li>
<li>可基于策略自动选择性日志：<ol style="list-style: lower-alpha;">
<li>监控某个变量，当变量符合某条件则日志。</li>
<li>定时日志，一条语句开启，一条语句关闭。</li>
</ol>
</li>
</ol>
</blockquote>
<div style="margin-bottom: 1em; margin-top: 1em;">
其中分析研究4.2的可行性花费了我一定的时间，在此做出一些记录。</div>
<h2 style="font-family: arial, helvetica, sans-serif; font-weight: 400; margin: 1.5em 0px -0.3em;">
原型</h2>
<div style="margin-bottom: 1em; margin-top: 1em;">
我说期望能够设计出的工具的使用原型可以用如下代码概括：</div>
<div style="margin-bottom: 1em; margin-top: 1em;">
<br /></div>
<div class="EnlighterJSWrapper droideEnlighterJSWrapper" style="font-family: Consolas, &quot;Source Code Pro&quot;, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, Courier, monospace; font-size: 10px; line-height: 16px; margin: 0px; overflow-wrap: break-word; overflow: auto; padding: 0px; position: relative; white-space: pre-wrap;">
<ol class="hoverEnabled droideEnlighterJS EnlighterJS" style="background-color: #f7f7f9; border: 1px solid rgb(224, 224, 224); color: #404141; font-size: 13px; line-height: 16px; list-style: none; margin: 0px 0px 20px; overflow-wrap: break-word; overflow: auto; padding: 0px;">
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 5px 5px 1px 14px;"><span class="de1" style="color: #cf6a4c; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">&lt;?php</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">……</span><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> // any context</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$logger</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">=</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> SimpleLogger::</span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">getInstance</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">-</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">&gt;</span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">getALogger</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="st0" style="color: #961414; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">"emailType"</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$timer_id</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">=</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$logger</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">-</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">&gt;</span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">logInTimer</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="nu0" style="color: #009999; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">3</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">*</span><span class="nu0" style="color: #009999; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">1000</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">,</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">[</span><span class="st1" style="color: #963f14; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">'functionName'</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">,</span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$object</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">,</span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$args</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">]</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">,rightnow_or_not,times</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">……</span><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> // Go ahead your business. (Timer表现为在另外一条流程线上等待被触发，如果触发，可以阻塞当前流程。)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">SimpleLogger::</span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">getInstance</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">-</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">&gt;</span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">killTimer</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$timer_id</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> // 另一个流程上的定时器被取消。</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">……</span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">// 以下对开发者透明：当前cli或者fpm进程结束时</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">onCurrentBusinessShutdown:</span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 5px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">SimpleLogger::</span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">getInstance</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">-</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">&gt;</span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">killTimer</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$timer_id</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
</ol>
</div>
<div style="margin-bottom: 1em; margin-top: 1em;">
<br /></div>
<div style="margin-bottom: 1em; margin-top: 1em;">
以上代码的主要表现则是，<strong>开发者</strong>不需要手动的使用代码去dispatch或者read来自外部的输入（定时器），而自动无察觉的当信号到来时执行之前设置好的回调。从而，开发者可以简单的使用我设计的工具，继续核心业务而无需将其绑定更多复杂的事件框架。</div>
<div style="margin-bottom: 1em; margin-top: 1em;">
虽然事件框架也可以“异步”或者说被动，无察觉地是某些注册过的函数在IO事件发生的时候（框架层面，而不是系统调用层面的IO事件）被调用。但是他对于一个<strong>工具的设计者</strong>（我）来说，最大的弊端就在于：</div>
<ol>
<li>它限定死了<strong>开发者</strong>的编码结构，几乎没有一个事件框架或库不是以事件循环作为程序的结尾的，开发者真正的开发入口从第一行代码，变成了事件回调的第一行代码。如果使用其设计一个简单的日志工具，对于开发者来说是极其不友好的，因为并不是所有开发者的业务都是基于事件的，有的或许仅仅是科学计算。</li>
<li>FPM，FCGI这些和Web相关的Sapi根本就不允许这么玩，像swoole，在fpm模式就根本是无法使用的。</li>
<li>如果开发者也是基于这个事件框架进行开发的，那么他使用该工具的话，在底层的资源调用上可能会发生冲突。</li>
</ol>
<h2 style="font-family: arial, helvetica, sans-serif; font-weight: 400; margin: 1.5em 0px -0.3em;">
如何实现</h2>
<h3 style="font-family: arial, helvetica, sans-serif; font-size: 1.5em; font-weight: 400; margin: 1.5em 0px -0.3em;">
declare</h3>
<div style="margin-bottom: 1em; margin-top: 1em;">
最通用但是性能最低的方法是<span class="mootwoEnlighterJS EnlighterJS" style="background-color: #f0f0f1; border-radius: 4px; border: 1px solid rgb(240, 240, 241); color: #333333; font-family: &quot;Source Code Pro&quot;, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, Courier, monospace; font-size: 10px; line-height: 16px; margin: 0px 2px; overflow-wrap: break-word; overflow: auto; padding: 3px 5px 1px; white-space: pre-wrap;"><span class="kw1" style="color: #b05098; font-family: inherit; font-size: 14px; font-weight: 700; line-height: inherit; margin: 0px; padding: 0px;">declare</span><span class="" style="color: #313437; font-family: inherit; font-size: 14px; line-height: inherit; margin: 0px; padding: 0px;"> ticks</span></span>，例如：</div>
<div class="EnlighterJSWrapper droideEnlighterJSWrapper" style="font-family: Consolas, &quot;Source Code Pro&quot;, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, Courier, monospace; font-size: 10px; line-height: 16px; margin: 0px; overflow-wrap: break-word; overflow: auto; padding: 0px; position: relative; white-space: pre-wrap;">
<ol class="hoverEnabled droideEnlighterJS EnlighterJS" style="background-color: #f7f7f9; border: 1px solid rgb(224, 224, 224); color: #404141; font-size: 13px; line-height: 16px; list-style: none; margin: 0px 0px 20px; overflow-wrap: break-word; overflow: auto; padding: 0px;">
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 5px 5px 1px 14px;"><span class="de1" style="color: #cf6a4c; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">&lt;?php</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">// 每一条低级语句执行一次回调</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw1" style="color: #12217c; font-family: inherit; font-size: 13px; font-weight: 700; line-height: inherit; margin: 0px; padding: 0px;">declare</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">ticks</span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">=</span><span class="nu0" style="color: #009999; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">1</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">register_tick_function</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="st1" style="color: #963f14; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">'check_timer'</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$time_now</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">=</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> time;</span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$interval</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">=</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="nu0" style="color: #009999; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">1000</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$callback</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">=</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="st0" style="color: #961414; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">"functionA"</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw1" style="color: #12217c; font-family: inherit; font-size: 13px; font-weight: 700; line-height: inherit; margin: 0px; padding: 0px;">function</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">check_timer</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">{</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw1" style="color: #12217c; font-family: inherit; font-size: 13px; font-weight: 700; line-height: inherit; margin: 0px; padding: 0px;">global</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$time_now</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw1" style="color: #12217c; font-family: inherit; font-size: 13px; font-weight: 700; line-height: inherit; margin: 0px; padding: 0px;">global</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$interval</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw1" style="color: #12217c; font-family: inherit; font-size: 13px; font-weight: 700; line-height: inherit; margin: 0px; padding: 0px;">global</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$callback</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw1" style="color: #12217c; font-family: inherit; font-size: 13px; font-weight: 700; line-height: inherit; margin: 0px; padding: 0px;">if</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">time</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">&gt;</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$interval</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="sy0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">+</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"> </span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$time_now</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">{</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">    </span><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">call_user_func_array</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="kw3" style="color: #445588; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">$callback</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">,</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">[</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">]</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">;</span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">    </span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">}</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">}</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="kw1" style="color: #12217c; font-family: inherit; font-size: 13px; font-weight: 700; line-height: inherit; margin: 0px; padding: 0px;">while</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="nu0" style="color: #009999; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">1</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">{</span><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" even" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 1px 14px;"><span class="co1" style="color: #086b08; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">// doing my jobs.</span><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span></li>
<li class=" odd" style="border-color: rgb(255, 255, 255) rgb(255, 255, 255) rgb(255, 255, 255) rgb(224, 224, 224); border-image: initial; border-style: solid solid solid dashed; border-width: 0px 0px 0px 1px; color: #707070; font-size: 11px; line-height: 18px; list-style: decimal; margin: 0px 0px 0px 40px; padding: 1px 5px 5px 14px;"><span class="" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;"></span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">}</span></li>
</ol>
</div>
<div style="margin-bottom: 1em; margin-top: 1em;">
他能对开发者透明地情况下让开发者的低级代码每执行declare的次数便回调一次，这样就能实现上述的开发者的业务代码和定时器同时执行的功能。同时他支持各个平台，已经所有Sapi。而且，基于declare的定时器也是同进程内部的，它可以实现对变量的监听。</div>
<h3 style="font-family: arial, helvetica, sans-serif; font-size: 1.5em; font-weight: 400; margin: 1.5em 0px -0.3em;">
异步信号处理</h3>
<div style="margin-bottom: 1em; margin-top: 1em;">
还有一个让我惊喜的方法是来自php7.1的新特性<span class="droideEnlighterJS EnlighterJS" style="background-color: #f7f7f9; border: 1px solid rgb(224, 224, 224); color: #333333; font-family: Consolas, &quot;Source Code Pro&quot;, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, Courier, monospace; font-size: 10px; line-height: 16px; margin: 0px 2px; overflow-wrap: break-word; overflow: auto; padding: 3px 5px 1px; white-space: pre-wrap;"><span class="me0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">pcntl_async_signals</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">(</span><span class="br0" style="color: black; font-family: inherit; font-size: 13px; line-height: inherit; margin: 0px; padding: 0px;">)</span></span>，他允许我们像C语言那样实现“抢占式”地对信号进行处理。而不需要手动执行dispatch函数进行等待，基于declare的信号处理本质上也是使用dispatch进行同步信号并调用处理函数。<del style="background: rgb(235, 237, 239); color: #31343a;">当被注册的信号发生时，不论当前（我没有考证是否PHP有不可重入函数）正在执行什么，php都将被调度到执行信号处理函数。</del>这使得我们可以更高性能，且更优雅地完成上述的需求。但是，这个功能基于PCNTL扩展，但是PCNTL扩展并不对Web相关的Sapi提供支持。</div>
<div style="margin-bottom: 1em; margin-top: 1em;">
<br /></div>
<h3 style="font-family: arial, helvetica, sans-serif; font-size: 1.5em; font-weight: 400; margin: 1.5em 0px -0.3em;">
多线程（<del style="background: rgb(235, 237, 239); color: #31343a;">多进程（由于不共享内存无法监听变量）</del>）</h3>
<div style="margin-bottom: 1em; margin-top: 1em;">
同样的因为fpm，fcgi之类Sapi本身就需要和HTTP Server交互，有自己的进、线程模型。所以对于更上层的开发者来说，几乎是无法使用多进程或多线程运用到自己的业务里的。cli模式下基于<span class="mootwoEnlighterJS EnlighterJS" style="background-color: #f0f0f1; border-radius: 4px; border: 1px solid rgb(240, 240, 241); color: #333333; font-family: &quot;Source Code Pro&quot;, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, Courier, monospace; font-size: 10px; line-height: 16px; margin: 0px 2px; overflow-wrap: break-word; overflow: auto; padding: 3px 5px 1px; white-space: pre-wrap;"><span class="" style="color: #313437; font-family: inherit; font-size: 14px; line-height: inherit; margin: 0px; padding: 0px;">pthread</span></span>扩展实现多线程，创建出一个专门的定时器线程并运用传统的事件处理库进行事件监听，一样可以完成上述的任务。</div>
<h3 style="font-family: arial, helvetica, sans-serif; font-size: 1.5em; font-weight: 400; margin: 1.5em 0px -0.3em;">
Exec</h3>
<div style="margin-bottom: 1em; margin-top: 1em;">
同样的，还有一种通用的各个Sapi都可以使用的方法，就是异步地调用Exec开启一个与定时器处理相关的php-cli后台进程。它的缺点则是，无法捕获到当前进程的销毁，无法监听变量。</div>
</div>
